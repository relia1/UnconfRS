<VirtualHost *:80>
    ServerName your-domain.com
    DocumentRoot /var/www/html

    # Redirect all HTTP traffic to HTTPS
    Redirect permanent / https://your-domain.com/
</VirtualHost>

<VirtualHost *:443>
    ServerName your-domain.com
    
    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/your-domain.crt
    SSLCertificateKeyFile /etc/ssl/private/your-domain.key
    # SSLCertificateChainFile /etc/ssl/certs/chain.crt  # Uncomment if needed
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Enable compression
    SetOutputFilter DEFLATE
    SetEnvIfNoCase Request_URI \
        \.(?:gif|jpe?g|png|ico|woff2?|ttf|eot)$ no-gzip dont-vary
    
    # Proxy configuration for the Rust application
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Pass real client IP to backend
    ProxyAddHeaders On
    RemoteIPHeader X-Forwarded-For
    RemoteIPTrustedProxy 127.0.0.1
    
    # Main proxy rule - pass everything to the Axum server
    ProxyPass / http://127.0.0.1:3000/
    ProxyPassReverse / http://127.0.0.1:3000/
    
    # WebSocket support (if needed in the future)
    ProxyPassMatch ^/(ws|websocket)/(.*) ws://127.0.0.1:3000/$1/$2
    
    # Error and access logs
    ErrorLog ${APACHE_LOG_DIR}/unconfrs_error.log
    CustomLog ${APACHE_LOG_DIR}/unconfrs_access.log combined
    
    # Optional: Rate limiting (requires mod_evasive)
    # DOSHashTableSize    512
    # DOSPageCount        3
    # DOSPageInterval     1
    # DOSSiteCount        50
    # DOSSiteInterval     1
    # DOSBlockingPeriod   600
</VirtualHost>