{% extends "base.html" %}

{% block title %}Event Schedule{% endblock %}

{% block head %}
    {% if schedule.is_some() && rooms.is_some() %}
        <style>{% include "../styles/display_schedule.css" %}</style>
        <script>
            window.APP = window.APP || {};
            window.APP.rooms = [
                {% if let Some(vec_rooms) = rooms %}
                    {% for room in vec_rooms %}
                        {
                            id: Number({{ room.id.unwrap() }}),
                            name: "{{ room.name }}",
                            available_spots: Number({{ room.available_spots }})
                        },
                    {% endfor %}
                {% endif %}
            ];

            window.APP.events = [
            {% for session_event in events %}
                {
                    roomId: Number({{ session_event.room_id }}),
                    startTime: "{{ session_event.start_time }}",
                    endTime: "{{ session_event.end_time }}",
                    timeslotId: Number({{ session_event.timeslot_id }}),
                    title: "{{ session_event.title }}",
                    sessionId: Number({{ session_event.session_id }}),
                    scheduleId: Number({{ session_event.schedule_id }})
                },
                {% endfor %}
            ];

            // Get unique timeslots from events
            window.APP.timeslots = [];
            window.APP.unpopulated_sessions = [];
            {% if let Some(schedule) = schedule %}
                {% for timeslot in schedule.timeslots %}
                    window.APP.timeslots.push(
                        {
                            id: {{ timeslot.id }},
                            start: "{{ timeslot.start_time }}",
                            end: "{{ timeslot.end_time }}"
                        }
                    );
                {% endfor %}

                {% if permissions.contains(&Permission::from("superuser")) %}
                    {% for unpopulated_session in unpopulated_sessions %}
                        window.APP.unpopulated_sessions.push(
                            {
                                id: {{ unpopulated_session.id.unwrap() }},
                                title: "{{ unpopulated_session.title }}"
                            }
                        );
                    {% endfor %}
                {% endif %}
            {% endif %}
        </script>
        {% if permissions.contains(&Permission::from("superuser")) %}
            <script src="../scripts/admin/admin_display_schedule.js"></script>
        {% else %}
            <script src="../scripts/display_schedule.js"></script>
        {% endif %}
    {% endif %}
{% endblock %}

{% block content %}
    {% if schedule.is_some() && rooms.is_some() %}
        {% include "snippets/display_schedule.html" %}
    {% else if permissions.contains(&Permission::from("superuser")) %}
        {% if !rooms.is_some() %}
            {% include "rooms.html" %}
        {% else %}
            {% include "timeslots.html" %}
        {% endif %}
    {% else %}
        <h2>Schedule has not been constructed yet!</h2>
        <p>Please return after the schedule has been constructed.</p>
    {% endif %}
{% endblock %}
