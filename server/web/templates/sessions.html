{% extends "base.html" %}

    {% block title %}MVP{% endblock %}

    {% block head %}
    <link href="https://cdn.datatables.net/v/dt/jq-3.7.0/dt-2.1.5/r-3.0.3/sl-2.0.5/datatables.min.css" rel="stylesheet">
    <style>
        table.dataTable thead th {
            text-align: center !important;
        }

        table.dataTable td {
            text-align: center !important;
        }

        dt, dd {
            text-align: left;
            margin-inline-start: 0;
        }

        .popup {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: #f9f9f9;
            padding: 20px;
            border: 1px solid #ccc;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
        }

        #emailField {
            display: none;
        }

    </style>
    <script src="https://cdn.jsdelivr.net/npm/idb-keyval@6/dist/umd.js"></script>
    <script src="https://cdn.datatables.net/v/dt/jq-3.7.0/dt-2.1.5/r-3.0.3/sl-2.0.5/datatables.min.js"></script>
    <script>
        let current_users_voted_sessions = {{ current_users_voted_sessions|json }};
        {% if permissions.contains(&Permission::from("superuser")) || permissions.contains(&Permission::from("staff")) %}
            {% include "scripts/admin/admin_or_staff_sessions.js" %}
        {% else %}
            {% include "scripts/sessions.js" %}
        {% endif %}
    </script>

    {% endblock %}

    {% block content %}
    <div class="container-fluid">
        {% if is_authenticated %}
            <div class="row mb-4">
                <div class="col-12">
                    <h1 class="mb-3">Submit a Session</h1>
                    <button id="add-session" class="btn btn-primary mb-4">Submit a Session</button>
                </div>
            </div>
        {% endif %}
        
        <div class="row">
            <div class="col-12">
                <h1 class="mb-3">Sessions</h1>
                <div class="table-responsive">
                    <table class="sessionsTable table table-striped table-hover">
                <thead>
                    <tr>
                        <th></th>
                        <th>Session ID</th>
                        <th>Title</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Tag</th>
                        <th>Delete Session</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in sessions %}
                        <tr data-session-id="{{ session.session_id }}" data-content="{{ session.content|escape }}" data-user-id="{{ session.user_id }}">
                            <td>
                            </td>
                            <td>
                                {{ session.session_id }}
                            </td>
                            <td>
                                {{ session.title }}
                            </td>
                            <td>
                                {{ session.fname }} {{ session.lname }}
                            </td>
                            <td>
                                {{ session.email }}
                            </td>
                            <td class="tag-cell" data-tag-ids="{{ session.tag_ids|join(",") }}">
                                {% if !session.tag_ids.is_empty() %}
                                    {{ self.resolve_tag_names(session.tag_ids)|join(", ") }}
                                {% endif %}
                            </td>
                            <td>
                            </td>
                            <td>
                                {{ session.content }}
                            </td>
                            <td>
                                {{ session.user_id }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap Modal -->
    <div class="modal fade" id="sessionModal" tabindex="-1" aria-labelledby="sessionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="sessionModalLabel">Session</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="sessionForm">
                        {% include "snippets/session_form_fields.html" %}
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="sessionForm" class="btn btn-primary">Save</button>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}
