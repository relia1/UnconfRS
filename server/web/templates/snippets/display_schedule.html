<style>
    .popup {
        display: none;
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background-color: #f9f9f9;
        padding: 20px;
        border: 1px solid #ccc;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        z-index: 1000;
    }

    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 999;
    }

    label.addRoom {
        display: inline-block;
    }

    label.addSession {
        display: inline-block;
    }

    select#sessions {
        display: inline-block;
    }

    .delete-room-btn {
        background: none;
        border: none;
        color: #ff4444;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        padding: 0 5px;
        margin-left: 8px;
        opacity: 0.7;
        display: none;  /* Hidden by default */
    }

    .delete-room-btn:hover {
        opacity: 1;
    }

    /* Show delete button when user is admin */
    .admin .delete-room-btn {
        display: inline-block;
        position: absolute;
        right: 5px;
        top: 50%;
        transform: translateY(-50%)
    }

    .column-header, .row-label {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #schedule-operations {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    .modal .form-label {
        display: block;
        font-weight: 500;
        margin-bottom: 0.5rem;
        color: #212529;
    }
</style>
<div id="eventSchedule">
    <div class="mb-3">
        <h1>Event Schedule</h1>
        {% if permissions.contains(&Permission::from("superuser")) %}
        <div id="schedule-operations">
            <button type="button" class="btn btn-primary mb-2" id="populate-schedule">Populate Schedule</button>
            <button type="button" class="btn btn-primary mb-2" id="clear-schedule">Clear Schedule</button>
            <button type="button" class="btn btn-primary mb-2" id="add-room">Add Room</button>
            <button type="button" class="btn btn-primary mb-2" id="add-session">Add Session</button>
            <a href="/unconf_timeslots" class="btn btn-primary mb-2" id="config-timeslots">Timeslot Configuration</a>
        </div>
        {% endif %}
    </div>
    <div id="controls" class="mb-3">
        <div class="row">
            <div class="col-md-3">
                <label for="view-selector" class="form-label">Choose view:</label>
                <select name="view-selector" class="form-select" id="view-selector">
                    <option value="time">Time-based</option>
                    <option value="room">Room-based</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="room-selector" class="form-label" id="room-selector-label">Choose room:</label>
                <select name="room-selector" class="form-select" id="room-selector">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>
            <div class="col-md-3">
                <label for="time-selector" class="form-label" id="time-selector-label">Choose time:</label>
                <select name="time-selector" class="form-select" id="time-selector">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>
        </div>
    </div>
    <div class="schedule-container{% if permissions.contains(&Permission::from("superuser")) %} admin{% endif %}">
        <div class="time-column">
            <div class="room-header">Time</div>
            <!-- Time slots will be dynamically added here -->
        </div>
        <!-- Room columns will be dynamically added here -->
    </div>
</div>
<!-- Bootstrap Modals -->
<div class="modal fade" id="addRoomModal" tabindex="-1" aria-labelledby="addRoomModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addRoomModalLabel">Add a Room</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addRoomForm">
                    <div class="mb-3">
                        <label for="room-name" class="form-label">Room Name:</label>
                        <input type="text" class="form-control" id="room-name" name="room-name" required>
                    </div>
                    <div class="mb-3">
                        <label for="room-location" class="form-label">Room Location:</label>
                        <input type="text" class="form-control" id="room-location" name="room-location" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="addRoomForm" class="btn btn-primary" id="submit-room-btn">Save</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addSessionModal" tabindex="-1" aria-labelledby="addSessionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addSessionModalLabel">Add a Session</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addSessionForm">
                    <div class="mb-3">
                        <label for="sessions" class="form-label">Session:</label>
                        <select name="sessions" class="form-select" id="sessions">
                            {% for session in unpopulated_sessions %}
                                <option value={{ session.id.unwrap() }}>{{ session.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="addSessionForm" class="btn btn-primary" id="submit-session-btn">Save</button>
            </div>
        </div>
    </div>
</div>
